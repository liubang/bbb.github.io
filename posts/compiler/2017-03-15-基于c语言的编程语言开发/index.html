<!doctype html><html class=position-relative itemscope itemtype=http://schema.org/WebPage lang=zh-cn data-bs-theme=auto data-palette=blue-gray><head><script src=https://iliubang.cn/assets/init/bundle.min.1e03a853d0c3a141bd1d6643ba64c9eda20118f424ea93628758812491d09915.js integrity="sha256-HgOoU9DDoUG9HWZDumTJ7aIBGPQk6pNih1iBJJHQmRU=" crossorigin=anonymous></script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>基于c语言的编程语言开发 - liubang's blog</title><link rel=icon href=https://iliubang.cn/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_16x16_resize_box_3.png sizes=16x16 type=image/png><link rel=icon href=https://iliubang.cn/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_32x32_resize_box_3.png sizes=32x32 type=image/png><link rel=apple-touch-icon href=https://iliubang.cn/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_180x180_resize_box_3.png sizes=180x180 type=image/png><link rel=icon href=https://iliubang.cn/favicon_huc1d2ba7c7d6d5aa3e01f2f328b911c53_11507_150x150_resize_box_3.png sizes=150x150 type=image/png><link rel=icon href="https://iliubang.cn/images/icons/icon-192x192.png?version=5675e36f11a529bcbecb4e1fae90c416" sizes=192x192><link rel=mask-icon href=https://iliubang.cn/safari-pinned-tab.svg color=#6f42c1><link rel=icon href="https://iliubang.cn/images/icons/favicon.ico?version=93c96d13551a46e5742ae6da86026661"><meta name=keywords content><meta name=description content="Preface# 当今世道，各种高级语言百花齐放。然而会有人发出这样的疑问&ndash;计算机真的能够识别这么多语言吗？稍微有点常识的人都知道，这显然是不可"><meta name=robots content="index, follow"><meta name=twitter:card content="summary"><meta name=twitter:title content="基于c语言的编程语言开发"><meta name=twitter:description content="Preface# 当今世道，各种高级语言百花齐放。然而会有人发出这样的疑问&ndash;计算机真的能够识别这么多语言吗？稍微有点常识的人都知道，这显然是不可"><meta property="og:title" content="基于c语言的编程语言开发"><meta property="og:description" content="Preface# 当今世道，各种高级语言百花齐放。然而会有人发出这样的疑问&ndash;计算机真的能够识别这么多语言吗？稍微有点常识的人都知道，这显然是不可"><meta property="og:type" content="article"><meta property="og:url" content="https://iliubang.cn/posts/compiler/2017-03-15-%E5%9F%BA%E4%BA%8Ec%E8%AF%AD%E8%A8%80%E7%9A%84%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E5%BC%80%E5%8F%91/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2017-03-15T00:00:00+00:00"><meta property="article:modified_time" content="2017-03-15T00:00:00+00:00"><meta itemprop=name content="基于c语言的编程语言开发"><meta itemprop=description content="Preface# 当今世道，各种高级语言百花齐放。然而会有人发出这样的疑问&ndash;计算机真的能够识别这么多语言吗？稍微有点常识的人都知道，这显然是不可"><meta itemprop=datePublished content="2017-03-15T00:00:00+00:00"><meta itemprop=dateModified content="2017-03-15T00:00:00+00:00"><meta itemprop=wordCount content="2919"><meta itemprop=keywords content="c,compiler,"><meta property="og:image" content="https://iliubang.cn/images/apple-touch-icon.png"><meta name=twitter:image content="https://iliubang.cn/images/apple-touch-icon.png"><link rel=manifest href=https://iliubang.cn/manifest.json><link data-precache rel=stylesheet href="https://iliubang.cn/assets/main/bundle.min.75e051a0e6aee08c7cc71339d7b5fa15d783dcb37821db6d6c9aeca24e8307da.css" integrity="sha256-deBRoOau4Ix8xxM517X6FdeD3LN4IdttbJrsok6DB9o=" crossorigin=anonymous><link data-precache rel=stylesheet href=https://iliubang.cn/assets/katex/bundle.min.c7738aed5534d96f5c4eb1790af05b44a2ca1cc7d0cb6d5de1dcf95595d3f91a.css integrity="sha256-x3OK7VU02W9cTrF5CvBbRKLKHMfQy21d4dz5VZXT+Ro=" crossorigin=anonymous><link data-precache rel=stylesheet href=https://iliubang.cn/assets/viewer/bundle.min.6b3e89d76811b1489a4460861c7fbae20302ef1003f264680b5c453cc225c486.css integrity="sha256-az6J12gRsUiaRGCGHH+64gMC7xAD8mRoC1xFPMIlxIY=" crossorigin=anonymous></head><body><header><nav class="top-app-bar shadow navbar navbar-expand-lg fixed-top"><div class=container><a class="navbar-brand d-flex align-items-center flex-grow-1 flex-lg-grow-0 text-lg-start ms-2 ms-lg-0 mx-auto me-lg-2" href=https://iliubang.cn><picture><img class=logo alt=Logo src=https://iliubang.cn/images/apple-touch-icon.png loading=lazy width=180 height=180>
</picture>HIGHKYCK</a>
<button class="navbar-toggler order-5" type=button data-bs-toggle=offcanvas data-bs-target=#navbarMenus aria-controls=navbarMenus aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-ellipsis-h"></i></button><div class="offcanvas-lg offcanvas-end flex-grow-1" data-bs-scroll=true tabindex=-1 id=navbarMenus aria-labelledby=navbarMenusLabel><div class="offcanvas-header px-4 pb-0"><h5 class=offcanvas-title id=navbarMenusLabel>liubang's blog</h5><button type=button class="btn-close btn-close-white" data-bs-dismiss=offcanvas data-bs-target=#navbarMenus aria-label=Close></button></div><div class="offcanvas-body p-4 pt-0 p-lg-0"><hr class=d-lg-none><ul class="navbar-nav flex-row flex-wrap align-items-center me-auto"><li class="nav-item col-6 col-lg-auto"><a class="nav-link py-2 px-0 px-lg-2" href=https://iliubang.cn/archives/><i class="fas fa-fw fa-file-archive"></i>归档</a></li><li class="nav-item col-6 col-lg-auto dropdown px-0"><a href=# class="nav-link dropdown-toggle" id=navbarDropdownCategories role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-folder"></i>分类</a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=navbarDropdownCategories data-bs-popper=none><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/categories/programming><i class="fas fa-fw fa-code me-1"></i>Programing</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/categories/reading><i class="fas fa-fw fa-book-reader me-1"></i>Reading</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/categories/linux><i class="fab fa-fw fa-linux me-1"></i>Linux</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/categories><i class="fas fa-fw fa-folder me-1"></i>所有分类</a></li></ul></li><li class="nav-item col-6 col-lg-auto dropdown px-0"><a href=# class="nav-link dropdown-toggle" id=navbarDropdownTags role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-tags me-1"></i>标签</a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=navbarDropdownTags data-bs-popper=none><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/tags/algorithm><i class="fas fa-fw fa-square-root-alt me-1"></i>Algorithm</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/tags/c++><i class="fab fa-fw fa-google me-1"></i>C++</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/tags/go><i class="fab fa-fw fa-google me-1"></i>Go</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/tags/java><i class="fab fa-fw fa-java me-1"></i>Java</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/tags/storage><i class="fas fa-fw fa-database me-1"></i>Storage</a></li><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/tags><i class="fas fa-fw fa-tags me-1"></i>所有标签</a></li></ul></li><li class="nav-item col-6 col-lg-auto dropdown px-0"><a href=# class="nav-link dropdown-toggle" id=navbarDropdownSeries role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-columns me-1"></i>专栏</a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=navbarDropdownSeries data-bs-popper=none><li><a class="dropdown-item text-wrap text-lg-nowrap" href=https://iliubang.cn/leetcode/>LeetCode</a></li></ul></li></ul><hr class=d-lg-none><form class="search-bar ms-auto my-1" action=https://iliubang.cn/search/ novalidate><div class="input-group input-group-sm align-items-center"><span class="btn btn-search disabled position-absolute left-0 border-0"><i class="fas fa-fw fa-search fa-lg"></i></span>
<input class="py-2 form-control rounded search-input" name=q type=search aria-label=Search required></div></form><hr class=d-lg-none><ul class="navbar-nav flex-row flex-wrap align-items-center ms-md-auto"><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><nav class="social-links nav justify-content-center flex-row"><a class="nav-link social-link col-6 col-lg-auto p-1" target=_blank href=https://github.com/liubang title=GitHub rel="noopener noreferrer"><i class="fa-fw fab fa-github"></i>
<span class="ms-1 d-lg-none">Github</span></a>
<a class="nav-link social-link col-6 col-lg-auto p-1" target=_blank href=https://iliubang.cn/index.xml title=RSS rel="noopener noreferrer"><i class="fas fa-fw fa-rss"></i>
<span class="ms-1 d-lg-none">RSS</span></a></nav></li><li class="nav-item py-2 py-lg-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div><hr class="d-lg-none my-2"></li><li class="nav-item dropdown py-1 py-lg-1 col-6 col-lg-auto"><a class="nav-link px-0 px-lg-1" href=# id=languageDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-globe"></i>
<span class=d-lg-none>语言</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=languageDropdown><li><a class=dropdown-item href=https://iliubang.cn/en/>English</a></li><li><a class="dropdown-item active" href=https://iliubang.cn/>简体中文</a></li></ul></li><li class="nav-item py-1 col-12 col-lg-auto"><div class="vr d-none d-lg-flex h-100 mx-lg-2 text-white"></div><hr class="d-lg-none my-2"></li><li class="nav-item dropdown col-6 col-lg-auto"><a class="nav-link px-0 py-2 px-lg-1" href=# id=paletteDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-palette"></i>
<span class=d-lg-none>配色</span></a><ul class="dropdown-menu dropdown-menu-end px-2" aria-labelledby=paletteDropdown><div class=row><li class="col-4 my-1"><a role=button id=palette-blue aria-label=蓝色 class="btn btn-sm w-100 palette text-bg-blue" data-palette=blue></a></li><li class="col-4 my-1"><a role=button id=palette-blue-gray aria-label=蓝灰色 class="btn btn-sm w-100 palette text-bg-blue-gray" data-palette=blue-gray></a></li><li class="col-4 my-1"><a role=button id=palette-brown aria-label=棕色 class="btn btn-sm w-100 palette text-bg-brown" data-palette=brown></a></li><li class="col-4 my-1"><a role=button id=palette-cyan aria-label=青色 class="btn btn-sm w-100 palette text-bg-cyan" data-palette=cyan></a></li><li class="col-4 my-1"><a role=button id=palette-green aria-label=绿色 class="btn btn-sm w-100 palette text-bg-green" data-palette=green></a></li><li class="col-4 my-1"><a role=button id=palette-indigo aria-label=靛青色 class="btn btn-sm w-100 palette text-bg-indigo" data-palette=indigo></a></li><li class="col-4 my-1"><a role=button id=palette-orange aria-label=橙色 class="btn btn-sm w-100 palette text-bg-orange" data-palette=orange></a></li><li class="col-4 my-1"><a role=button id=palette-pink aria-label=粉色 class="btn btn-sm w-100 palette text-bg-pink" data-palette=pink></a></li><li class="col-4 my-1"><a role=button id=palette-purple aria-label=紫色 class="btn btn-sm w-100 palette text-bg-purple" data-palette=purple></a></li><li class="col-4 my-1"><a role=button id=palette-red aria-label=红色 class="btn btn-sm w-100 palette text-bg-red" data-palette=red></a></li><li class="col-4 my-1"><a role=button id=palette-teal aria-label=蓝绿色 class="btn btn-sm w-100 palette text-bg-teal" data-palette=teal></a></li><li class="col-4 my-1"><a role=button id=palette-yellow aria-label=黄色 class="btn btn-sm w-100 palette text-bg-yellow" data-palette=yellow></a></li></div></ul></li><li class="nav-item dropdown col-6 col-lg-auto"><a class="nav-link px-0 py-2 px-lg-1" href=# id=modeDropdown role=button data-bs-toggle=dropdown aria-expanded=false><i class="mode-icon fas fa-fw fa-adjust" id=modeIcon></i>
<span class=d-lg-none>模式</span></a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=modeDropdown><li class=mode-item data-color-mode=light data-icon=sun><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-sun"></i> Light</button></li><li class=mode-item data-color-mode=dark data-icon=moon><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-moon"></i> Dark</button></li><li class="mode-item active" data-color-mode=auto data-icon=adjust><button class=dropdown-item>
<i class="mode-icon fas fa-fw fa-adjust"></i> Auto</button></li></ul></li></ul></div></div></div></nav></header><main class=container><div class="row content"><noscript><div class="alert alert-danger" role=alert>你的浏览器不支持 JavaScript。</div></noscript><div class=col-lg-8><div class=container><nav class="row card component" aria-label=breadcrumb><div class="card-body pb-0"><ol class=breadcrumb><li class="breadcrumb-item text-surface"><a href=https://iliubang.cn/>主页</a></li><li class="breadcrumb-item text-surface"><a href=https://iliubang.cn/posts/>文章</a></li><li class="breadcrumb-item active">基于c语言的编程语言开发</li></ol></div></nav><div class="post-panel-wrapper position-sticky"><div class="d-flex flex-column component rounded post-panel position-absolute border"><a class="action action-panel-toggler" role=button title="Panel toggler"><i class="fas fa-fw fa-chevron-circle-down"></i></a>
<a id=sidebarToggler class="action d-none d-lg-block" role=button title="Sidebar toggler"><i class="fas fa-fw fa-expand-alt" data-fa-transform=rotate-45></i></a>
<a class="action btn-reward" role=button data-bs-toggle=modal data-bs-target=#rewardModal title=打赏><i class="fas fa-fw fa-coffee"></i></a>
<a class=action href=#post-copyright role=button aria-label=Copyright title=Copyright><i class="fas fa-fw fa-copyright"></i></a>
<a class=action href=#post-comments role=button aria-label=Comments title=Comments><i class="fas fa-fw fa-comments"></i></a>
<a class=action href=#postTOC aria-controls="Table of contents" role=button title="Table of contents"><i class="fas fa-fw fa-list-alt"></i></a></div></div><article class="row card component mb-4 post"><div class=card-header><h1 class="card-title post-title my-2">基于c语言的编程语言开发</h1></div><div class=card-body><div class="post-meta mb-3"><span class="post-date me-1 mb-1" title="创建于 2017-03-15 00:00:00 +0000 UTC。">2017-03-15</span><span class="post-reading-time me-1 mb-1">6 分钟阅读</span><a href=https://iliubang.cn/categories/programming/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-category">
<i class="fas fa-fw fa-folder me-1"></i>Programming</a><a href=https://iliubang.cn/tags/c/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-tag">C</a><a href=https://iliubang.cn/tags/compiler/ class="btn btn-sm btn-secondary mb-1 me-2 py-0 pe-1 post-taxonomy post-tag">Compiler</a></div><div id=postTOC class="mt-2 mb-4 d-block d-lg-none"><h2 class="text-surface mb-3">目录</h2><div id=post-toc-container></div></div><div class="post-share mb-3"><div class=addthis_inline_share_toolbox></div></div><div class="post-content mb-3" data-bs-spy=scroll data-bs-target=#TableOfContents tabindex=0><div id=post-content-body><h2 id=preface data-numberify>Preface<a class="anchor ms-1 d-none" href=#preface>#</a></h2><p>当今世道，各种高级语言百花齐放。然而会有人发出这样的疑问&ndash;计算机真的能够识别这么多语言吗？稍微有点常识的人都知道，这显然是不可能滴！在计算机的世界里，他们能够直接识别的只有机器语言。然而，由于机器语言对人类不够友好，所以人们才发明了汇编，c，Java&mldr;许许多多的人类易读的编程语言，所以我个人对编程语言的理解一直是其实他们就是机器语言的语法糖，而编程语言的创造过程，就是定义一种合理的，没有二义性的语法规则，然后就是通过直接或间接的方式实现该语法到机器语言的转换过程。既然是这样的话，那么我们就很容易想到，计算机语言是一个自我完善的过程：首先我们定了一种非常简单的 x1(这里只是用来举例说明，有没有 x 语言有待考证)语言，然后用机器语言实现了这个非常简单的 x1 语言的编译器，创造了 x1 语言，实现了非常简单的新特性，然后我们再用 x1 语言(相对于机器语言较高级)实现了另一些新的特性的 x2 语言的编译器，创造了 x2 语言，&mldr;，如此下去，人们创造了汇编语言，从而创造了 c 语言，接着创造了世界上最好的语言 PHP(不知道是不是真的，反正大家都习惯这么说)。
在各种高级语言越来越强大的今天，我们可能很难再会去接触最原始的东西，高度封装确实提高了生产力，降低了学习成本，但是也使得现代程序员将太多精力花在了各种说明书上，而不清楚其本质。
毕业一年多，工作了一年多，对于计算机编程有了自己的看法，不再像在大学的时候认识的那样肤浅，反而觉得大学中学习的知识才是真正的干货，不禁感叹曾经浪费掉了大好光阴。好在陶渊明有词云：“悟已往之不谏，知来者之可追”。
闲暇之余，扒开 PHP(这里之所以是 PHP 并不因为他是世界上最好的语言，只是因为我目前从事的是 PHP 开发的工作而已)源码，了解了其内部构造和实现原理，百看不一练。今天就初步学习 yacc/lex 了，记录在我的博客中，以便以后翻阅巩固。</p><h2 id=过程简述 data-numberify>过程简述<a class="anchor ms-1 d-none" href=#过程简述>#</a></h2><p>一般来说编程语言的解释执行过程如下：</p><p><strong>ONE</strong>. 词法分析
将源代码拆分成若干 Token 的过程</p><p><strong>TWO</strong>.语法分析
将 Token 构建成 Syntax Tree 的过程</p><p><strong>THREE</strong>.生成执行码
生成可执行文件</p><h2 id=yaccyet-another-compiler-compiler data-numberify>yacc（Yet Another Compiler Compiler）<a class="anchor ms-1 d-none" href=#yaccyet-another-compiler-compiler>#</a></h2><p>下面是 wikipedia 中对 yacc 的描述</p><blockquote><p>Yacc is a computer program for the Unix operating system. It is a Look Ahead Left-to-Right (LALR) parser generator, generating a parser, the part of a compiler that tries to make syntactic sense of the source code, specifically a LALR parser, based on an analytic grammar written in a notation similar to Backus–Naur Form (BNF). Yacc itself used to be available as the default parser generator on most Unix systems, though it has since been supplanted as the default by more recent, largely compatible, programs.</p></blockquote><p>其安装非常简单</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install bison
</span></span></code></pre></div><h2 id=lexflex data-numberify>lex/flex<a class="anchor ms-1 d-none" href=#lexflex>#</a></h2><p>lex 是一个生成词法分析器的工具。Lex 读进一个代表词法分析器规则的输入字符串流，然后输出以 C 语言实做的词法分析器源代码。传统上，lex 属于商业软件，但是有些根据原本 AT&T 代码这些版本的 Lex 可以以公开源代码的形式获得，并被视为某些系统的一部分，例如说 OpenSolaris 和贝尔实验室九号项目。另一个有名的 Lex 公开源代码版本是 flex，代表"快速的词法分析器"（fast lexical analyzer）</p><p>在 linux 下安装</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get install flex
</span></span></code></pre></div><h2 id=practice data-numberify>practice<a class="anchor ms-1 d-none" href=#practice>#</a></h2><ul><li>实现一个简单的计算程序</li></ul><p>首先定义 lex 规则，其扩展名为<code>.l</code>，在 lex 中可以很容易读懂其定义的规则，因为他用到的是正则表达式。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>%</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> |------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm> | linger test
</span></span></span><span class=line><span class=cl><span class=cm> |------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm> | @author    : liubang
</span></span></span><span class=line><span class=cl><span class=cm> | @date      : 16/10/27 下午8:28
</span></span></span><span class=line><span class=cl><span class=cm> | @copyright : (c) iliubang.cn
</span></span></span><span class=line><span class=cl><span class=cm> | @license   : MIT (http://opensource.org/licenses/MIT)
</span></span></span><span class=line><span class=cl><span class=cm> |------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&#34;y.tab.h&#34;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>yywrap</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s>&#34;+&#34;</span>		<span class=k>return</span> <span class=n>ADD</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;-&#34;</span>		<span class=k>return</span> <span class=n>SUB</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;*&#34;</span>		<span class=k>return</span> <span class=n>MUL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;/&#34;</span>		<span class=k>return</span> <span class=n>DIV</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=s>&#34;</span><span class=se>\n</span><span class=s>&#34;</span>		<span class=k>return</span> <span class=n>CR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>([</span><span class=mi>1</span><span class=o>-</span><span class=mi>9</span><span class=p>][</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=o>*</span><span class=p>)</span><span class=o>|</span><span class=mi>0</span><span class=o>|</span><span class=p>([</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=o>+</span><span class=err>\</span><span class=p>.[</span><span class=mi>0</span><span class=o>-</span><span class=mi>9</span><span class=p>]</span><span class=o>+</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>sscanf</span><span class=p>(</span><span class=n>yytext</span><span class=p>,</span> <span class=s>&#34;%lf&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>d</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>yylval</span><span class=p>.</span><span class=n>double_value</span> <span class=o>=</span> <span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>DOUBLE_LITERAL</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span> <span class=err>\</span><span class=n>t</span><span class=p>]</span> <span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>.</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;lexical error.</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>%%</span>
</span></span></code></pre></div><p>可以看到以上的代码主要包含两部分，<code>%{</code> <code>%}</code>包含的部分和<code>\%\%</code> <code>\%\%</code>包含的部分。前一部分叫<strong>定义区块</strong>, 后者是<strong>规则区块</strong>，定义区块内的代码将会被原样输出，在定义区块中<code>#include "y.tab.h"</code>将会在 yacc 编译其规则文件后自动生成，<code>ADD</code> <code>SUB</code> <code>MUL</code> <code>DIV</code> <code>CR</code> <code>DOUBLE_LITERAL</code>等都是在 y.tab.h 中定义的 macro。
在定义区块中，有一个名为<code>yywrap</code>的 function，其作用是自动 link lex 的库文件。
至于规则区块，学过正则表达式的人一看就会明白，其作用就是使用正则表达式来描述 Token。规则区块的定义为：正则表达式，后边跟上 C 代码，这些代码用<code>{}</code>括起来，读入的字符流满足了正则，则执行其后的代码，匹配到的原字符被保存在<code>yytext</code>这个全局变量中。</p><p>接着来编写 yacc 的规则，其扩展名为<code>.y</code>。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>%</span><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cm>/*
</span></span></span><span class=line><span class=cl><span class=cm> |------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm> | linger test
</span></span></span><span class=line><span class=cl><span class=cm> |------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm> | @author    : liubang
</span></span></span><span class=line><span class=cl><span class=cm> | @date      : 16/10/27 下午8:43
</span></span></span><span class=line><span class=cl><span class=cm> | @copyright : (c) iliubang.cn
</span></span></span><span class=line><span class=cl><span class=cm> | @license   : MIT (http://opensource.org/licenses/MIT)
</span></span></span><span class=line><span class=cl><span class=cm> |------------------------------------------------------------------
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define YYDEBUG 1
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=k>union</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kt>int</span>	<span class=n>int_value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=kt>double</span>	<span class=n>double_value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>token</span> <span class=o>&lt;</span><span class=n>double_value</span><span class=o>&gt;</span>		<span class=n>DOUBLE_LITERAL</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>token</span> <span class=n>ADD</span> <span class=n>SUB</span> <span class=n>MUL</span> <span class=n>DIV</span> <span class=n>CR</span>
</span></span><span class=line><span class=cl><span class=o>%</span><span class=n>type</span> <span class=o>&lt;</span><span class=n>double_value</span><span class=o>&gt;</span> <span class=n>expression</span> <span class=n>term</span> <span class=n>primary_expression</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nl>line_list</span>
</span></span><span class=line><span class=cl>	<span class=p>:</span> <span class=n>line</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>line_list</span> <span class=n>line</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>line</span>
</span></span><span class=line><span class=cl>	<span class=p>:</span> <span class=n>expression</span> <span class=n>CR</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>printf</span><span class=p>(</span><span class=s>&#34;&gt;&gt;%lf</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=err>$</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>expression</span>
</span></span><span class=line><span class=cl>	<span class=p>:</span> <span class=n>term</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>expression</span> <span class=n>ADD</span> <span class=n>term</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>+</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>expression</span> <span class=n>SUB</span> <span class=n>term</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>-</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>term</span>
</span></span><span class=line><span class=cl>	<span class=p>:</span> <span class=n>primary_expression</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>term</span> <span class=n>MUL</span> <span class=n>primary_expression</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>*</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>term</span> <span class=n>DIV</span> <span class=n>primary_expression</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>/</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>primary_expression</span>
</span></span><span class=line><span class=cl>	<span class=p>:</span> <span class=n>DOUBLE_LITERAL</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>%%</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>yyerror</span><span class=p>(</span><span class=kt>char</span> <span class=k>const</span> <span class=o>*</span><span class=n>str</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>extern</span> <span class=kt>char</span> <span class=o>*</span><span class=n>yytext</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;syntax error near %s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>yytext</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=n>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>extern</span> <span class=kt>int</span> <span class=n>yyparse</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>extern</span> <span class=n>FILE</span> <span class=o>*</span><span class=n>yyin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>yyin</span> <span class=o>=</span> <span class=n>stdin</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=n>yyparse</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>fprintf</span><span class=p>(</span><span class=n>stderr</span><span class=p>,</span> <span class=s>&#34;Core Dump!</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>yacc 规则定义跟 lex 相似，都用到了<code>\%{\%}</code> <code>\%\%</code>来包含代码块。
同样的是<code>\%{\%}</code>包裹的代码将被原样输出。
在<code>\%union</code>定义中，声明了记号和非终结符的类型，其最终会被编译成一个 c 语言的 union。这里定义了一个 int 类型的 int_value 和 double 类型的 double_value。
<code>\%token</code>开头的行是 Token 的声明，所有用到的 Token 类型都在这里定义。对于<code>ADD</code> <code>SUB</code> <code>MUL</code> <code>DIV</code> <code>CR</code>等记号只需要包含其类型即可，而对于值为<code>DOUBLE_LITERAL</code>的 Token，其类型被指定为<code>&lt;double_value></code>，这里的 double_value 正是来自于前面声明的 union 中的成员之一。
<code>%%</code>包裹的部分叫做规则区块，由语法规则和 C 语言编写的相应的行为两部分构成。在 yacc 中使用了类似于 BNF 范式来编写语法规则。由于使用了自然语言作为标记，理解上还是很容易的。下面举个简单的例子：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>line_list</span>                 <span class=cm>/* 多行规则 */</span>
</span></span><span class=line><span class=cl>	<span class=o>:</span> <span class=n>line</span>                  <span class=cm>/* 单行 */</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>line_list</span> <span class=n>line</span>        <span class=cm>/* 或者多行后跟单行 */</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>line</span>                       <span class=cm>/* 单行 */</span>
</span></span><span class=line><span class=cl>	<span class=o>:</span> <span class=n>expression</span> <span class=n>CR</span>          <span class=cm>/* 表达式后跟换��符 */</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>expression</span>                 <span class=cm>/* 表达式 */</span>
</span></span><span class=line><span class=cl>	<span class=o>:</span> <span class=n>term</span>                   <span class=cm>/* 和项 */</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>expression</span> <span class=n>ADD</span> <span class=n>term</span>    <span class=cm>/* 或者表达式加上和项 */</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>                        <span class=cm>/* 匹配后执行的action */</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>+</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>expression</span> <span class=n>SUB</span> <span class=n>term</span>    <span class=cm>/* 或者表达式减去和项 */</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>                        <span class=cm>/* 匹配后执行的action */</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>-</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>term</span>                        <span class=cm>/* 和项 */</span>
</span></span><span class=line><span class=cl>	<span class=o>:</span> <span class=n>primary_expression</span>      <span class=cm>/* 一元表达式 */</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>term</span> <span class=n>MUL</span> <span class=n>primary_expression</span> <span class=cm>/* 或者和项乘以一元表达式 */</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>                          <span class=cm>/* 匹配后执行的action */</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>*</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>|</span> <span class=n>term</span> <span class=n>DIV</span> <span class=n>primary_expression</span> <span class=cm>/* 或者和项除以一元表达式 */</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>                             <span class=cm>/* 匹配后执行的action */</span>
</span></span><span class=line><span class=cl>		<span class=err>$$</span> <span class=o>=</span> <span class=err>$</span><span class=mi>1</span> <span class=o>/</span> <span class=err>$</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>primary_expression</span>          <span class=cm>/* 一元表达式 */</span>
</span></span><span class=line><span class=cl>	<span class=o>:</span> <span class=n>DOUBLE_LITERAL</span>          <span class=cm>/* 实数字面量 */</span>
</span></span><span class=line><span class=cl><span class=p>;</span>
</span></span></code></pre></div><p>写好了规则，那么就来编译运行</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>yacc -dv foo.y
</span></span><span class=line><span class=cl>flex foo.l
</span></span><span class=line><span class=cl>gcc -std<span class=o>=</span>c99 -Wall -g -o foo y.tab.c lex.yy.c
</span></span></code></pre></div><p>这样就生成了<code>foo</code>这个可执行文件
运行 foo</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>liubang@venux:~/workspace/c/my_lang/lex$ make run
</span></span><span class=line><span class=cl><span class=m>1</span> + <span class=m>3</span>
</span></span><span class=line><span class=cl>&gt;&gt;4.000000
</span></span><span class=line><span class=cl>1/2
</span></span><span class=line><span class=cl>&gt;&gt;0.500000
</span></span><span class=line><span class=cl><span class=m>4</span> * <span class=m>5</span>
</span></span><span class=line><span class=cl>&gt;&gt;20.000000
</span></span></code></pre></div><p>当然我个人在开发 c 程序的时候偏向于使用 make 工具来编译代码，这样会很方便。下面是我的 Makefile 文件:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-makefile data-lang=makefile><span class=line><span class=cl><span class=nv>CFLAGS</span> <span class=o>=</span> -O2 -g -Wall -std<span class=o>=</span>c99
</span></span><span class=line><span class=cl><span class=nv>EXEC</span> <span class=o>=</span> foo
</span></span><span class=line><span class=cl><span class=nv>OBJS</span> <span class=o>=</span>	y.tab.o <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>	lex.yy.o
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>%.c</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	yacc -dv foo.y
</span></span><span class=line><span class=cl>	lex foo.l
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>%.o</span><span class=o>:</span> %.<span class=n>c</span>
</span></span><span class=line><span class=cl>	 <span class=k>$(</span>CC<span class=k>)</span> <span class=k>$(</span>CFLAGS<span class=k>)</span> -o <span class=nv>$@</span> -c $&lt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>$(EXEC)</span><span class=o>:</span> <span class=k>$(</span><span class=nv>OBJS</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>CC<span class=k>)</span> <span class=k>$(</span>OBJS<span class=k>)</span> -o <span class=nv>$@</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>all</span><span class=o>:</span> <span class=k>$(</span><span class=nv>EXEC</span><span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>run</span><span class=o>:</span> <span class=k>$(</span><span class=nv>EXEC</span><span class=k>)</span>
</span></span><span class=line><span class=cl>	@./<span class=k>$(</span>EXEC<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>clean</span><span class=o>:</span>
</span></span><span class=line><span class=cl>	<span class=k>$(</span>RM<span class=k>)</span> <span class=k>$(</span>OBJS<span class=k>)</span> <span class=k>$(</span>EXEC<span class=k>)</span>
</span></span></code></pre></div><p>只需要执行<code>make run</code>命令即可运行！</p><h2 id=附加 data-numberify>附加<a class="anchor ms-1 d-none" href=#附加>#</a></h2><p>可能有人会疑惑，这玩意学着有什么用，那么有兴趣的你可以下载一份 PHP 的源代码，在 Zend(Zend 引擎核心文件)目录中你不难找到<code>zend_language_scanner.l</code>,<code>zend_ini_scanner.l</code>,<code>zend_ini_parser.y</code>,<code>zend_language_parser.y</code>这几个文件，打开其内容，是不是不再那么恐惧和陌生了呢。</p><h2 id=summary data-numberify>Summary<a class="anchor ms-1 d-none" href=#summary>#</a></h2><p>本文只是初步介绍 yacc/lex 工具生成词法解析器和语法解析器的最基本用法，没有太多的阐述词法解析的原理和过程，所以更偏实践，再由于本人毕业一年多实在很久没写文章了，常常会提笔不知从何说起，所以写起来很慢，加之白天要工作，时间较紧，所以今天就到这里了，至于理论的阐述，需要时间来慢慢酝酿 😂！</p></div></div><div class="modal fade" id=rewardModal tabindex=-1 aria-labelledby=rewardModalLabel aria-hidden=true><div class=modal-dialog><div class="modal-content surface"><div class=modal-header><h5 class="modal-title text-surface" id=rewardModalLabel><i class="fas fa-fw fa-coffee me-1"></i>打赏</h5><a href=# data-bs-dismiss=modal class=btn-close aria-label=Close></a></div><div class=modal-body><ul class="nav nav-tabs mb-3" role=tablist><li class="nav-item text-nowrap" role=presentation><a class="nav-link active" id=reward-alipay-tab data-bs-toggle=tab href=#reward-alipay role=tab aria-controls=reward-alipay aria-selected=true><i class="fab fa-fw fa-alipay me-1"></i>支付宝</a></li><li class="nav-item text-nowrap" role=presentation><a class=nav-link id=reward-wechat-tab data-bs-toggle=tab href=#reward-wechat role=tab aria-controls=reward-wechat aria-selected=true><i class="fab fa-fw fa-weixin me-1"></i>微信</a></li></ul><div class=tab-content id=rewardTabContent><div class="tab-pane fade post-reward-content text-center show active" id=reward-alipay role=tabpanel aria-labelledby=reward-alipay-tab><img class="img-fluid post-reward-img" src=https://iliubang.cn/images/reward/alipay.jpg loading=lazy data-viewer-invisible></div><div class="tab-pane fade post-reward-content text-center show" id=reward-wechat role=tabpanel aria-labelledby=reward-wechat-tab><img class="img-fluid post-reward-img" src=https://iliubang.cn/images/reward/wechat.jpg loading=lazy data-viewer-invisible></div></div></div></div></div></div></div><div class=card-footer><div class="post-navs d-flex justify-content-evenly"><div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-down post-prev-icon me-1" data-fa-transform=rotate-90></i>
<a href=https://iliubang.cn/posts/php/2017-03-09-php%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91%E4%B9%8Bcall-user-func%E5%8E%9F%E7%90%86%E5%92%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/>PHP扩展开发之call_user_func原理和回调函数的实现</a></div><div class="post-nav post-next"><a href=https://iliubang.cn/posts/sp/2017-03-17-%E5%BD%BB%E5%BA%95%E6%8E%8C%E6%8F%A1malloc/>彻底掌握malloc</a>
<i class="fas fa-fw fa-chevron-down post-next-icon ms-1" data-fa-transform=rotate-270></i></div></div></div></article><div class="post-copyright mb-3 row card component" id=post-copyright><div class=card-header><h2 class="card-title fs-4 my-2 text-surface">版权</h2></div><div class=card-body><a class="d-flex align-items-center flex-column" target=_blank rel="license noopener noreferrer" href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh><span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-nc"></i><i class="fab fa-fw fa-2x fa-creative-commons-nd"></i></span>
CC BY-NC-ND 4.0</a></div></div><section class="related-posts row card component"><div class=card-header><h2 class="card-title fs-4 my-2 text-surface">相关文章</h2></div><div class=card-body><ul class="post-list list-unstyled"><li class="mb-3 border-bottom"><a class=post-title href=https://iliubang.cn/posts/php/2017-03-09-php%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91%E4%B9%8Bcall-user-func%E5%8E%9F%E7%90%86%E5%92%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/>PHP扩展开发之call_user_func原理和回调函数的实现</a>
<span class="post-meta post-date float-end">2017-03-09</span><div class="post-summary my-3"><p>函数调用# 很多时候，我们需要通过函数名来调用函数，并传递参数，或者把匿名函数作为函数的参数传递，实现回调。当我们在遇到这样的需求的时候，用 php 代码实现起来肯定是非常容易和简单的。但是，当我们在用 c 语言编写 php 扩展的时候，如何来实现这样的功能呢？下面就一起来深入了解 php 内核，看看如何实现。
在 Zend 引擎中，给我们提供了zend_call_function,call_user_function以及call_user_function_ex函数来帮助我们实现函数调用。在zend_API.h文件中，我们可以看到如下函数原型的声明：
ZEND_API int...</p><div><a class="btn btn-sm btn-outline-primary btn-read-more" href=https://iliubang.cn/posts/php/2017-03-09-php%E6%89%A9%E5%B1%95%E5%BC%80%E5%8F%91%E4%B9%8Bcall-user-func%E5%8E%9F%E7%90%86%E5%92%8C%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/>阅读更多</a></div></div></li></ul></div></section><div class="card component row post-comments" id=post-comments><div class=card-header><h2 class="card-title my-2 fs-4 text-surface">评论</h2></div><div class=card-body><script src=https://utteranc.es/client.js repo=liubang/blog issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div><aside class="col-lg-4 sidebar d-flex"><div class="container d-flex flex-column"><div class="accordion profile"><div class="accordion-item card row text-center component"><div class="accordion-header card-header border-0" id=profile-header><a class="accordion-button d-lg-none mb-2 shadow-none p-0 bg-transparent text-surface" type=button data-bs-toggle=collapse data-bs-target=#profile aria-expanded=true aria-controls=profile>Profile</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=profile aria-labelledby=profile-header><div class="col-12 d-flex align-items-center justify-content-center"><picture><img class="profile-avatar rounded-circle" alt=liubang src=https://iliubang.cn/images/profile.webp loading=lazy data-viewer-invisible width=484 height=483></picture></div><div class="col-12 profile-meta"><div class="profile-name fw-fold fs-lg">liubang</div><div class=profile-bio>Whether you are an antelope or a lion, you ought to dash forward without hesitation when the sun rise</div><div class=profile-company><i class="fas fa-fw fa-building"></i>Baidu</div><div class=profile-location><i class="fas fa-fw fa-map-marker-alt"></i>Beijing</div><div class="profile-about text-primary"><i class="fas fa-fw fa-user"></i><a href=https://iliubang.cn/about/>关于</a></div></div><nav class="social-links nav justify-content-center mt-1 justify-content-around"><a class="nav-link social-link" href=mailto:it.liubang@gmail.com title=电子邮箱><i class="fas fa-fw fa-2x fa-envelope"></i></a>
<a class="nav-link social-link" target=_blank href=https://github.com/liubang title=GitHub rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-github"></i></a>
<a class="nav-link social-link" target=_blank href=https://weibo.com/2113750192 title=微博 rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-weibo"></i></a>
<a class="nav-link social-link" target=_blank href=https://iliubang.cn/index.xml title=RSS rel="noopener noreferrer"><i class="fas fa-fw fa-2x fa-rss"></i></a></nav></div></div></div><div class="accordion taxonomies-toggle"><section class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent" type=button data-bs-toggle=collapse data-bs-target=#taxonomies-toggle aria-expanded=true aria-controls=taxonomies-toggle>Taxonomies</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=taxonomies-toggle><ul class="nav nav-pills nav-fill" id=myTab role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=taxonomyTagsTab data-bs-toggle=tab data-bs-target=#taxonomyTags type=button role=tab aria-controls=标签 aria-selected=true>
标签</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomySeriesTab data-bs-toggle=tab data-bs-target=#taxonomySeries type=button role=tab aria-controls=专栏 aria-selected=true>
专栏</button></li><li class=nav-item role=presentation><button class=nav-link id=taxonomyArchivesTab data-bs-toggle=tab data-bs-target=#taxonomyArchive type=button role=tab aria-controls=taxonomyArchives aria-selected=true>
归档</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=taxonomyTags role=tabpanel aria-labelledby=taxonomyTagsTab tabindex=0><a href=https://iliubang.cn/tags/c++/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=c++>c++
<span class="badge badge-sm text-secondary bg-white ms-1">17</span></a>
<a href=https://iliubang.cn/tags/c/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=c>c
<span class="badge badge-sm text-secondary bg-white ms-1">14</span></a>
<a href=https://iliubang.cn/tags/php/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=php>php
<span class="badge badge-sm text-secondary bg-white ms-1">8</span></a>
<a href=https://iliubang.cn/tags/sp/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=sp>sp
<span class="badge badge-sm text-secondary bg-white ms-1">5</span></a>
<a href=https://iliubang.cn/tags/c++17/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=c++17>c++17
<span class="badge badge-sm text-secondary bg-white ms-1">4</span></a>
<a href=https://iliubang.cn/tags/c++11/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=c++11>c++11
<span class="badge badge-sm text-secondary bg-white ms-1">3</span></a>
<a href=https://iliubang.cn/tags/java/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=Java>Java
<span class="badge badge-sm text-secondary bg-white ms-1">3</span></a>
<a href=https://iliubang.cn/tags/jni/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=JNI>JNI
<span class="badge badge-sm text-secondary bg-white ms-1">3</span></a>
<a href=https://iliubang.cn/tags/c++14/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=c++14>c++14
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=https://iliubang.cn/tags/compiler/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=compiler>compiler
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href=https://iliubang.cn/tags class="btn btn-sm btn-secondary post-taxonomy ps-3 post-tag me-2 mb-2" title=全部>全部
<span class="badge badge-sm text-secondary bg-white ms-1">23</span></a></div><div class=tab-pane id=taxonomySeries role=tabpanel aria-labelledby=taxonomySeriesTab tabindex=0><a href=https://iliubang.cn/series/leetcode/ class="btn btn-sm btn-secondary post-taxonomy ps-3 post-series me-2 mb-2" title=LeetCode>LeetCode
<span class="badge badge-sm text-secondary bg-white ms-1">2</span></a></div><div class=tab-pane id=taxonomyArchive role=tabpanel aria-labelledby=taxonomyArchiveTab tabindex=0><a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2022>2022 <span class="badge badge-sm text-secondary bg-white ms-1">12</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2021>2021 <span class="badge badge-sm text-secondary bg-white ms-1">1</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2020>2020 <span class="badge badge-sm text-secondary bg-white ms-1">1</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2019>2019 <span class="badge badge-sm text-secondary bg-white ms-1">2</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2018>2018 <span class="badge badge-sm text-secondary bg-white ms-1">10</span></a>
<a href class="btn btn-sm btn-secondary post-taxonomy ps-3 me-2 mb-2" title=2017>2017 <span class="badge badge-sm text-secondary bg-white ms-1">15</span></a></div></div></div></section></div><div class="accordion posts-toggle"><section class="row card component accordion-item"><div class="accordion-header card-header border-0"><a class="accordion-button d-lg-none mb-1 shadow-none p-0 bg-transparent" type=button data-bs-toggle=collapse data-bs-target=#posts-toggle aria-expanded=true aria-controls=posts-toggle>文章</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block show" id=posts-toggle><ul class="nav nav-pills nav-fill" id=myTab role=tablist><li class=nav-item role=presentation><button class="nav-link active" id=recent-posts-tab data-bs-toggle=tab data-bs-target=#recent-posts type=button role=tab aria-controls=recent-posts aria-selected=true>
最近文章</button></li></ul><div class="tab-content mt-3"><div class="tab-pane active" id=recent-posts role=tabpanel aria-labelledby=recent-posts-tab tabindex=0><ul class="post-list list-unstyled ms-1"><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://iliubang.cn/posts/rust/2022-11-01-rust%E5%92%8Cc++%E5%AF%B9%E6%AF%94%E4%B9%8B%E5%8F%AF%E5%8F%98%E6%80%A7%E7%A7%BB%E5%8A%A8%E5%92%8C%E6%89%80%E6%9C%89%E6%9D%83/>Rust和C+++: 可变性、移动和所有权</a><div class="post-meta mt-2"><span class=post-date>2022-11-01</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://iliubang.cn/posts/cpp/2022-09-28-%E4%B8%BA%E4%BB%80%E4%B9%88c++%E4%B8%AD%E6%9C%89%E4%BA%86%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E5%8D%B4%E8%BF%98%E9%9C%80%E8%A6%81stdfunction/>为什么c++中有了函数指针却还需要std::function</a><div class="post-meta mt-2"><span class=post-date>2022-09-28</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://iliubang.cn/posts/cpp/2022-05-15-%E4%BD%BF%E7%94%A8stdlist%E7%9A%84splice%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0lru-cache/>使用std::list的splice方法实现LRU Cache</a><div class="post-meta mt-2"><span class=post-date>2022-05-15</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://iliubang.cn/posts/cpp/2022-05-03-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3enable_shared_from_this/>深入理解 enable_shared_from_this</a><div class="post-meta mt-2"><span class=post-date>2022-05-03</span></div></div></div></li><li class=mb-2><div class=d-flex><div class="flex-grow-1 d-flex flex-column h-auto justify-content-center"><a class=post-title href=https://iliubang.cn/posts/cpp/2022-04-20-c++%E4%B8%ADunique_ptr%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/>c++ 中 unique_ptr 的一些使用技巧</a><div class="post-meta mt-2"><span class=post-date>2022-04-20</span></div></div></div></li></ul></div></div></div></section></div><div class="accordion post-toc d-none d-lg-block"><div class="accordion-item row mb-4 card component" id=postTOC><div class="card-header accordion-header"><h2 class="card-title fs-4 my-2 text-surface d-none d-lg-block">目录</h2><a class="accordion-button d-lg-none mb-1 collapsed shadow-none p-0 bg-transparent" type=button data-bs-toggle=collapse data-bs-target=#post-toc aria-expanded=false aria-controls=post-toc>目录</a></div><div class="card-body collapse accordion-collapse accordion-body d-lg-block" id=post-toc aria-labelledby=post-toc-header><nav id=TableOfContents><ul><li><a href=#preface>Preface</a></li><li><a href=#过程简述>过程简述</a></li><li><a href=#yaccyet-another-compiler-compiler>yacc（Yet Another Compiler Compiler）</a></li><li><a href=#lexflex>lex/flex</a></li><li><a href=#practice>practice</a></li><li><a href=#附加>附加</a></li><li><a href=#summary>Summary</a></li></ul></nav></div></div></div></div></aside></div></main><footer class="footer mt-auto py-3 text-center container"><div class="offcanvas offcanvas-bottom h-auto" tabindex=-1 id=offcanvasActionsPanel aria-labelledby=offcanvasActionsPanelLabel><div class=offcanvas-header><h5 class="offcanvas-title fs-4" id=offcanvasActionsPanelLabel><i class="fas fa-fw fa-th-large me-1"></i>
操作</h5><button type=button class="btn-close ms-auto" data-bs-dismiss=offcanvas data-bs-target=offcanvasActionsPanel aria-label=Close></button></div><div class="offcanvas-body mt-2"><div class="social-share mb-4 d-flex overflow-auto"><a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Twitter Share Button" target=_blank href="https://twitter.com/intent/tweet?title=%e5%9f%ba%e4%ba%8ec%e8%af%ad%e8%a8%80%e7%9a%84%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80%e5%bc%80%e5%8f%91&url=https%3a%2f%2filiubang.cn%2fposts%2fcompiler%2f2017-03-15-%25E5%259F%25BA%25E4%25BA%258Ec%25E8%25AF%25AD%25E8%25A8%2580%25E7%259A%2584%25E7%25BC%2596%25E7%25A8%258B%25E8%25AF%25AD%25E8%25A8%2580%25E5%25BC%2580%25E5%258F%2591%2f"><i class="fab fa-2x fa-fw fa-twitter mb-2"></i> Twitter</a>
<a class="btn-social-share d-flex flex-column align-items-center me-3" rel="noopener noreferrer" aria-label="Facebook Share Button" target=_blank href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2filiubang.cn%2fposts%2fcompiler%2f2017-03-15-%25E5%259F%25BA%25E4%25BA%258Ec%25E8%25AF%25AD%25E8%25A8%2580%25E7%259A%2584%25E7%25BC%2596%25E7%25A8%258B%25E8%25AF%25AD%25E8%25A8%2580%25E5%25BC%2580%25E5%258F%2591%2f"><i class="fab fa-2x fa-fw fa-facebook-f mb-2"></i> Facebook</a></div><hr class=mb-4><div class="actions d-flex overflow-auto align-items-center"><a role=button class="action action-go-back d-flex flex-column align-items-center me-3" href="javascript: window.history.back();"><span class="action-icon mb-2"><i class="fas fa-2x fa-chevron-circle-down" data-fa-transform=rotate-90></i></span> 返回</a>
<a role=button class="action action-reload-page d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-redo-alt"></i></span> 刷新</a>
<a role=button class="action action-copy-url d-flex flex-column align-items-center me-3"><span class="action-icon mb-2"><i class="fas fa-2x fa-link"></i></span> 复制链接</a></div></div></div><nav class="social-links nav justify-content-center mb-2"><a class="nav-link social-link" href=mailto:it.liubang@gmail.com title=电子邮箱><i class="fas fa-fw fa-2x fa-envelope"></i></a>
<a class="nav-link social-link" target=_blank href=https://github.com/liubang title=GitHub rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-github"></i></a>
<a class="nav-link social-link" target=_blank href=https://weibo.com/2113750192 title=微博 rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-weibo"></i></a>
<a class="nav-link social-link" target=_blank href=https://iliubang.cn/index.xml title=RSS rel="noopener noreferrer"><i class="fas fa-fw fa-2x fa-rss"></i></a></nav><div class="copyright mb-2">Copyright © 2016-2022 LiuBang. All Rights Reserved.</div><div class="powered-by mb-2">Powered by <a class=text-primary href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> and the <a class=text-primary href=https://github.com/razonyang/hugo-theme-bootstrap target=_blank rel="noopener noreferrer">HBS</a> theme.</div></footer><script data-precache src=https://iliubang.cn/assets/main/bundle.min.bbd7e8eb0af837ad178c695db6ddfd3c90f84c046c3cdd765b0df7de513be9ef.js integrity="sha256-u9fo6wr4N60XjGldtt39PJD4TARsPN12Ww333lE76e8=" crossorigin=anonymous defer></script><script data-precache src=https://iliubang.cn/assets/icons/bundle.min.a3f51959f91b82be9edbe44b13aba0386cf09f6022965403965dd9fa0c2ef4d5.js integrity="sha256-o/UZWfkbgr6e2+RLE6ugOGzwn2AillQDll3Z+gwu9NU=" crossorigin=anonymous defer></script>
<script data-precache src=https://iliubang.cn/assets/viewer/bundle.min.022f18de50f73bc4c4627eed46b63629d0a4856fdce1f78aa3debb68c1b3291d.js integrity="sha256-Ai8Y3lD3O8TEYn7tRrY2KdCkhW/c4feKo967aMGzKR0=" crossorigin=anonymous defer></script><script data-precache defer src=https://iliubang.cn/assets/katex/bundle.min.5d4e21071a95ce5b1f635fc99cc98e30d14b157ff223fb4f76117fdf4029c3a5.js integrity="sha256-XU4hBxqVzlsfY1/JnMmOMNFLFX/yI/tPdhF/30Apw6U=" crossorigin=anonymous></script>
<script data-precache defer src=https://iliubang.cn/assets/mermaid/bundle.min.e0678d67a61d9ab297dc3f1de9ca8e43614ce49e9e0d310b80787e532fca37a1.js integrity="sha256-4GeNZ6YdmrKX3D8d6cqOQ2FM5J6eDTELgHh+Uy/KN6E=" crossorigin=anonymous></script>
<script async src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5e89c5f05bb0c6ec"></script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("https://iliubang.cn/service-worker.min.js").then(function(e){console.log("Successfully registered service worker",e)}).catch(function(e){console.warn("Error whilst registering service worker",e)})})</script></body></html>